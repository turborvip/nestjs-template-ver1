version: '3.8'

services:
  redis:
    image: redis:latest  
    container_name: redis-container
    ports:
      - "6379:6379"  # Expose Redis port
    environment:
      - REDIS_PASSWORD=123456a  
    command: ["redis-server", "--requirepass", "123456a"]  
    volumes:
      - redis-data:/data  # Persistent storage for Redis data
    networks:
      - turborvip-network  # Network name
    restart: always  
    logging:
      driver: "json-file"  # Log format, can change as needed
      options:
        max-size: "10m"  # Limit log file size
        max-file: "3"  # Limit the number of log files
    mem_limit: 3g  # Limit memory for the container
    mem_reservation: 1g  # Memory reservation warning threshold
    cpus: 0.5  # CPU allocation (50%)

  postgresql:
    image: postgres:latest   # PostgreSQL image
    container_name: postgresql-container
    ports:
      - "5432:5432"  # Expose PostgreSQL port
    environment:
      - POSTGRES_USER=turborvip  # PostgreSQL user
      - POSTGRES_PASSWORD=123456a  # PostgreSQL password
      - POSTGRES_DB=turborvip_db_postgresql  # Default database name
    volumes:
      - postgres-data:/var/lib/postgresql/data  # Persistent storage for PostgreSQL
    networks:
      - turborvip-network  # Network name
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    mem_limit: 2g  # Limit memory for the container
    mem_reservation: 1g  # Memory reservation warning threshold
    cpus: 1  # CPU allocation (100%)

  mysql:
    image: mysql:latest  # MySQL image
    container_name: mysql-container
    ports:
      - "3306:3306"  # Expose MySQL port
    environment:
      - MYSQL_ROOT_PASSWORD=123456a  # Root password for MySQL
      - MYSQL_USER=turborvip  # MySQL user
      - MYSQL_PASSWORD=123456a  # User password for MySQL
      - MYSQL_DATABASE=turborvip_db_mysql  # Default database to create
    volumes:
      - mysql-data:/var/lib/mysql  # Persistent storage for MySQL
    networks:
      - turborvip-network  # Network name
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    mem_limit: 2g  # Limit memory for the container
    mem_reservation: 1g  # Memory reservation warning threshold
    cpus: 1  # CPU allocation (100%)

volumes:
  redis-data:
    driver: local  # Persistent volume for Redis
  postgres-data:
    driver: local  # Persistent volume for PostgreSQL
  mysql-data:
    driver: local  # Persistent volume for MySQL

networks:
  turborvip-network:
    driver: bridge  # Bridge network for both Redis and PostgreSQL
    driver_opts:
      com.docker.network.bridge.name: "turborvip-net"  # Network name
